#ifndef LLVM_GAMEBOY_SUBTARGET_H
#define LLVM_GAMEBOY_SUBTARGET_H

#include "llvm/CodeGen/TargetSubtargetInfo.h"
#include "llvm/Target/TargetMachine.h"

#include "GameBoyFrameLowering.h"
#include "GameBoyISelLowering.h"
#include "GameBoyInstrInfo.h"
#include "GameBoySelectionDAGInfo.h"
#include "MCTargetDesc/GameBoyMCTargetDesc.h"

#define GET_SUBTARGETINFO_HEADER
#include "GameBoyGenSubtargetInfo.inc"

namespace llvm {

class GameBoySubtarget : public GameBoyGenSubtargetInfo {
public:
    GameBoySubtarget(const Triple &TT, const std::string &CPU, const std::string &FS, 
                     const GameBoyTargetMachine &TM);

    const GameBoyInstrInfo *getInstrInfo() const override { return &InstrInfo; }
    const TargetFrameLowering *getFrameLowering() const override {
        return &FrameLowering;
    }
    const GameBoyTargetLowering *getTargetLowering() const override {
        return &TLInfo;
    }
    const GameBoySelectionDAGInfo *getSelectionDAGInfo() const override {
        return &TSInfo;
    }
    const GameBoyRegisterInfo *getRegisterInfo() const override {
        return &InstrInfo.getRegisterInfo();
    }

    /// Parses a subtarget feature string, setting appropriate options.
    /// \note Definition of function is auto generated by `tblgen`.
    void ParseSubtargetFeatures(StringRef CPU, StringRef TuneCPU, StringRef FS);

    GameBoySubtarget &initializeSubtargetDependencies(StringRef CPU, StringRef FS,
                                                    const TargetMachine &TM);

private:
    GameBoyInstrInfo InstrInfo;
    GameBoyFrameLowering FrameLowering;
    GameBoyTargetLowering TLInfo;
    GameBoySelectionDAGInfo TSInfo;
};

} // end namespace llvm

#endif // LLVM_GAMEBOY_SUBTARGET_H
